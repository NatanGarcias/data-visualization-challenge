<!DOCTYPE html>
<html>
<head>
	<title>Family Tree</title>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<style>
		rect{
			stroke: silver;
			width: 80px;
			height: 40px;
			stroke-width: 2;
		}
		path{
			fill: none;
			stroke: silver;
			stroke-width: 2;
		}
		text{
			dominant-baseline: middle;
			text-anchor: middle;
		}
		.bigger{
			font-size: 14px;
		}
		.hide{
			visibility: hidden;
		}
	</style>
</head>
<body>
	<script>
		var svg = d3.select("body").append("svg")
					.attr("width", 900).attr("height", 600)
					.append("g").attr("transform", "translate(50, 50)");

		// Insert code to import and parse CSV file here.
		var data = [{"child":"Batman", "parent":"", "spouse":"W_Woman", "suicide":"yes", "spouse_suicide":"no"},
					{"child":"Robin", "parent":"Batman", "spouse":"C_Woman", "spouse_suicide":"yes"},
					{"child":"Joker", "parent":"Batman"},
					{"child":"NWing", "parent":"Robin"},
					{"child":"Penguin", "parent":"Robin"},
					{"child":"The Flash", "parent":"Penguin"},
					{"child":"Bane", "parent":"Penguin", "suicide":"yes", "spouse":"Vampire", "spouse_suicide":"no"}
					];

		var dataStructure = d3.stratify()
							  .id(function(d){return d.child;})
							  .parentId(function(d){return d.parent;})(data);
        var treeStructure = d3.tree().size([650,300]);
        var information = treeStructure(dataStructure);
        console.log(information.descendants());

        // Connection lines.
        var connections = svg.append("g").selectAll("path")
        					.data(information.links());
        connections.enter().append("path").attr("d", function(d){
					return "M" + (d.source.x - 20) + "," + d.source.y + " v 50 H" + d.target.x + " V" + d.target.y;
				});

        // Men rectangles.
        var rectangles = svg.append("g").selectAll("rect").data(information.descendants());
        rectangles.enter().append("rect")
        	.attr("x", function(d){return d.x - 60;})
        	.attr("y", function(d){return d.y - 20;})
        	.attr("fill", function(d){
        		if(d.data.suicide == undefined)
        			return "white"
        		else 
        			return "#ff9999";
        	});

        // Spouse rectangles.
        var spouseRectangles = svg.append("g").selectAll("rect").data(information.descendants());
        spouseRectangles.enter().append("rect")
        	.attr("x", function(d){return d.x + 25;})
        	.attr("y", function(d){return d.y - 20;})
        	.classed("hide", function(d){
        		if(d.data.spouse == undefined)
        			return true;
        		else
        			return false;
        	})
        	.attr("fill", function(d){
        		if(d.data.spouse != undefined &&
        			d.data.spouse_suicide == "yes")
        			return "#ff9999"
        		else 
        			return "white";
        	});

        // Men's name.
        var names = svg.append("g").selectAll("text")
        				.data(information.descendants());
        names.enter().append("text")
        			.text(function(d){return d.data.child;})
        			.attr("x", function(d){return d.x - 20;})
        			.attr("y", function(d){return d.y;})
        			.classed("bigger", true);

        // Spouse's name.
        var spouseNames = svg.append("g").selectAll("text")
        					.data(information.descendants());
        spouseNames.enter().append("text")
        	.text(function(d){return d.data.spouse;})
        	.attr("x", function(d){return d.x + 65;})
        	.attr("y", function(d){return d.y;})
        	.classed("bigger", true);

	</script>
</body>
</html>
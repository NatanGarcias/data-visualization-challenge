<!DOCTYPE html>
<html>
<head>
	<title>Family Tree</title>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<style>
		path{
			fill: none;
			stroke: gray;
			stroke-width: 1.5;
		}
		text{
			dominant-baseline: middle;
			text-anchor: middle;
		}
		.bigger{
			font-size: 14px;
		}
		#details
		{
			position: absolute;
			left: 320px;
			top: 120px;
			width: 200px;
			height: 50px;
			background: gray;
			color: black;
			visibility: hidden;
			border-radius: 15px;
			text-align: center;
			padding: 15px;
			font-size: 20px;
		}
		.hide{
			visibility: hidden;
		}
	</style>
</head>
<body>
	<script>
		var svg = d3.select("body").append("svg")
					.attr("width", 10000).attr("height", 10000) // Page sizes.
					.append("g").attr("transform", "translate(50, 50)");

		// Insert code to import and parse CSV file here.
		var data = [{"child":"36153", "parent":"", "spouse":"36152", "spouse_suicide":"no", "sex":"M"}, {"child":"36151", "parent":"36153","spouse": "36150", "spouse_suicide": "no","suicide":"no"},{"child":"67079", "parent":"36153","spouse": "67080", "spouse_suicide": "no","suicide":"no"},{"child":"1689", "parent":"36153","spouse": "1688", "spouse_suicide": "no","suicide":"no"},{"child":"28453", "parent":"36153","spouse": "28454", "spouse_suicide": "no","suicide":"no"},{"child":"62883", "parent":"36153","spouse": "62884", "spouse_suicide": "no","suicide":"no"},{"child":"42470", "parent":"36153","spouse": "42471", "spouse_suicide": "no","suicide":"no"},{"child":"63554", "parent":"36153","spouse": "63553", "spouse_suicide": "no","suicide":"no"},{"child":"21773", "parent":"36153","spouse": "21775", "spouse_suicide": "no","suicide":"no"},{"child":"21809", "parent":"36153","spouse": "21810", "spouse_suicide": "no","suicide":"no"},{"child":"31660", "parent":"21773","spouse": "31659", "spouse_suicide": "no","suicide":"no"},{"child":"36156", "parent":"36151","spouse": "36157", "spouse_suicide": "no","suicide":"no"},{"child":"62334", "parent":"63554","spouse": "62331", "spouse_suicide": "no","suicide":"no"},{"child":"67085", "parent":"67079","spouse": "67087", "spouse_suicide": "no","suicide":"no"},{"child":"67093", "parent":"67079","spouse": "67094", "spouse_suicide": "no","suicide":"no"},{"child":"1690", "parent":"1689","spouse": "1691", "spouse_suicide": "no","suicide":"no"},{"child":"5806", "parent":"21809","spouse": "5805", "spouse_suicide": "no","suicide":"no"},{"child":"60624", "parent":"42470","spouse": "60623", "spouse_suicide": "no","suicide":"no"},{"child":"6638", "parent":"21809","spouse": "6639", "spouse_suicide": "no","suicide":"no"},{"child":"65522", "parent":"62883","spouse": "65524", "spouse_suicide": "no","suicide":"no"},{"child":"17892", "parent":"63554","spouse": "17891", "spouse_suicide": "no","suicide":"no"},{"child":"5654", "parent":"1689","spouse": "5655", "spouse_suicide": "no","suicide":"no"},{"child":"26428", "parent":"28453","spouse": "26429", "spouse_suicide": "no","suicide":"no"}
					];

	var dataStructure = d3.stratify()
			     .id(function(d){return d.child;})
			     .parentId(function(d){return d.parent;})(data);

        var treeStructure = d3.tree().size([4000,1300]);
        var information = treeStructure(dataStructure);
        console.log(information.descendants());

        // Connection lines.
        var connections = svg.append("g").selectAll("path")
        					.data(information.links());
        connections.enter().append("path")
                           .attr("d", function(d){
				return "M" + (d.source.x) + "," + d.source.y + " C " + 
				d.source.x + "," + (d.source.y + d.target.y)/2 + " " +
				d.target.x + "," + (d.source.y + d.target.y)/2 + " " +
				d.target.x + "," + d.target.y;
			     });

        // Family member's node.
        var nodes = svg.append("g").selectAll("circle").data(information.descendants());
        nodes.enter().append("circle")
        	.attr("cx", function(d){return d.x;})
        	.attr("cy", function(d){return d.y;})
        	.attr("r", 10)
        	.attr("fill", function(d){
        		if(d.data.suicide != undefined &&
        			d.data.suicide == "yes")
        			return "red"
        		else 
        			return "gray";
        	})

                // ! Implementing feature: show suicide's details on mouse overlay.

        	.on("mouseover", function(d){
        		 console.log("a");
        		// d3.select("#details").style("visibility", "visible")
        		//   .html(function(){
        		//   	return "Sex: " + d.data.sex; //+ "\n" +
        		//   		   // "Dead? " + d.data.deceased + "\n" +
        		//   		   // "Age: " + d.data.age + "\n" +
        		//   		   // "B_date: " + d.data.bdate + "\n" +
        		//   		   // "D_date: " + d.data.ddate + "\n" +
        		//   		   // "GEN: " + d.data.gen + "\n";
        		//   });
        	})
        	.on("mouseout", function(){
        		console.log("b");
        		// d3.select("#details").style("visibility", "hidden");
        	});;

        // Spouse nodes.
        var spouseNodes = svg.append("g").selectAll("circle").data(information.descendants());
        spouseNodes.enter().append("circle")
        	.attr("cx", function(d){return d.x + 30;})
        	.attr("cy", function(d){return d.y;})
        	.attr("r", 10)
        	.classed("hide", function(d){
        		if(d.data.spouse == undefined)
        			return true;
        		else
        			return false;
        	})
        	.attr("fill", function(d){
        		if(d.data.spouse != undefined &&
        			d.data.spouse_suicide == "yes")
        			return "red"
        		else 
        			return "black";
        	});

        // Family members names.
        var names = svg.append("g").selectAll("text").data(information.descendants());
        names.enter().append("text")
        			.text(function(d){return d.data.child;})
        			.attr("x", function(d){return d.x - 0;})
        			.attr("y", function(d){return d.y - 15;})
        			.classed("bigger", true);

        // Spouses names.
        var spouseNames = svg.append("g").selectAll("text").data(information.descendants());
        spouseNames.enter().append("text")
        	.text(function(d){return d.data.spouse;})
        	.attr("x", function(d){return d.x + 30;})
        	.attr("y", function(d){return d.y + 25;})
        	.classed("bigger", true);

	</script>
</body>
</html>
